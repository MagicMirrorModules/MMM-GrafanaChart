# Magic Mirror Module: MMM-GrafanaChart
This [MagicMirrorÂ²](http://robstechlog.com/2017/06/25/building-a-big-magicmirror-with-metal-frame-the-summary/) module allows you to display a chart generated by [grafana](https://grafana.com/).

<b>Important Note:</b> This module requires a running grafana installation. To install Grafana, follow the official [installation instructions](http://docs.grafana.org/installation/).

<b>[This blogpost](http://www.robstechlog.com/2017/06/30/personal-weather-chart-module/) describes how to install and use grafana and build a weatherchart.</b><br>
![example of a grafana weather chart](https://github.com/SvenSommer/MMM-GrafanaChart/blob/master/weather_explained.gif?raw=true)

## Installation of the module

In your terminal, go to your MagicMirror's Module folder:
````
cd ~/MagicMirror/modules
````

Clone this repository:
````
git clone https://github.com/SvenSommer/MMM-GrafanaChart
````

Configure the module in your `config.js` file.

## Configuration
<b> Configuration of the Grafana </b>

Change the grafana.ini to have the following settings
````ini
[auth.anonymous]

# enable anonymous access
enabled = true

# specify role for unauthenticated users
org_role = Viewer

[security]
# https://grafana.com/docs/grafana/latest/installation/configuration/#allow-embedding
allow_embedding = true
````
<b> Configuration of the MagicMirror config-file </b>

To use this module, you have to specify where your grafana installation is hosted and which chart you'd like to display.


Add the module to the modules array in the `config/config.js` file:
````javascript
modules: [
	{
		module: 'MMM-GrafanaChart',
		position: 'top_right',   // This can be any of the regions.
		config: {
				url: "https://localhost:5000/....", // see below on how to get the URL from Grafana
				width: "100%", // Optional. Default: 100%
				height: "100%", // Optional. Default: 100%
				scrolling: "no", // Optional. Default: no
				refreshInterval: 900 //Optional. Default: 900 = 1/4 hour
		}
	},
]
````

Grafana has a nice dialog that allows you to generate the embed URL you need.

For this make sure that your current view of the graph represents the time range and autorefresh interval you want on your mirror.

Then click the graph's header, go to "Share", then into the "Embed" tab.

Deselect the "Current time range" option, which would turn your "last three hours" query into the actual last three hours in absolute time.

Afterwards you can copy the URL from the `iframe`'s `src` attribute. Open it in a tab to check that everything looks and behaves as you would like.

If everything is as you like, you can copy the URL and paste it in the `url` config option.

Here is the process in a short animated form:
![How to get the URL](EmbedURL_from_Grafana.gif)

## Optional configuration options

The following properties can be configured:


<table width="100%">
	<!-- why, markdown... -->
	<thead>
		<tr>
			<th>Option</th>
			<th width="100%">Description</th>
		</tr>
	<thead>
	<tbody>
		<tr>
			<td><code>width</code></td>
			<td>Width of the displayed chart. <code>'150 px'</code> or <code>'50 %'</code> are valid options.	<br><b>Default value:<code>"100%"</code></b></td>
		</tr>
		<tr>
			<td><code>height</code></td>
			<td>Height of the displayed chart. <code>'150 px'</code> or <code>'50 %'</code> are valid options.	<br><b>Default value:<code>"100%"</code></b></td>
		</tr>
		<tr>
			<td><code>refreshInterval</code></td>
			<td>Update interval of the diagram in seconds.
				<br><b>Default value:</b> <code>900</code>  = 15 \* 60 (four times every hour)
			</td>
		</tr>
		<tr>
			<td><code>scrolling</code></td>
			<td>if set to <code>yes</code> it enables the iframe content to be scrollable.
				<br><b>Default value:</b> <code>no</code>
			</td>
		</tr>
	</tbody>
</table>
